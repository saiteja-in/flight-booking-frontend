<div class="min-h-[80vh] bg-slate-50 py-10">
  <div class="mx-auto max-w-4xl px-4">
    <div class="mb-8">
      <button
        type="button"
        (click)="goBack()"
        class="mb-4 flex items-center text-sm text-slate-600 hover:text-slate-800">
        <svg class="mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Back to Search
      </button>
      <h1 class="text-3xl font-semibold text-slate-800">Book Flight</h1>
      <p class="mt-2 text-slate-500">Enter passenger details to complete your booking.</p>
    </div>

    @if (error()) {
      <div class="mb-6 rounded-lg bg-red-50 p-4 text-red-800">
        <p class="font-medium">{{ error() }}</p>
      </div>
    }

    @if (success()) {
      <div class="mb-6 rounded-lg bg-green-50 p-6">
        <div class="flex items-start">
          <svg class="mr-3 h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div class="flex-1">
            <h3 class="text-lg font-semibold text-green-800">{{ success() }}</h3>
            @if (pnr()) {
              <p class="mt-2 text-green-700">
                <span class="font-medium">PNR:</span>
                <span class="font-mono text-lg font-bold">{{ pnr() }}</span>
              </p>
              <p class="mt-2 text-sm text-green-600">Please save this PNR for your records.</p>
            }
          </div>
        </div>
      </div>
    }

    @if (!success()) {
      <form [formGroup]="bookingForm" (ngSubmit)="submit()" class="rounded-xl bg-white p-6 shadow-md">
        <!-- Contact Email -->
        <div class="mb-6">
          <label for="contactEmail" class="mb-2 block text-sm font-medium text-slate-700">
            Contact Email <span class="text-red-500">*</span>
          </label>
          <input
            type="email"
            id="contactEmail"
            formControlName="contactEmail"
            class="block w-full rounded-md border border-slate-200 bg-white px-4 py-3 text-slate-800 shadow-sm outline-none transition hover:border-slate-300 focus:border-indigo-400 focus:ring-1 focus:ring-indigo-300"
            placeholder="your.email@example.com"
            [class.border-red-500]="bookingForm.get('contactEmail')?.invalid && bookingForm.get('contactEmail')?.touched" />
          @if (bookingForm.get('contactEmail')?.invalid && bookingForm.get('contactEmail')?.touched) {
            <p class="mt-1 text-sm text-red-600">
              @if (bookingForm.get('contactEmail')?.errors?.['required']) {
                Contact email is required.
              } @else if (bookingForm.get('contactEmail')?.errors?.['email']) {
                Please enter a valid email address.
              }
            </p>
          }
        </div>

        <!-- Passengers Section -->
        <div class="mb-6">
          <div class="mb-4 flex items-center justify-between">
            <h2 class="text-lg font-semibold text-slate-800">Passengers</h2>
            <button
              type="button"
              (click)="addPassenger()"
              class="rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white transition hover:bg-indigo-700">
              + Add Passenger
            </button>
          </div>

          <div formArrayName="passengers" class="space-y-6">
            @for (passenger of passengers.controls; track $index) {
              <div [formGroupName]="$index" class="rounded-lg border border-slate-200 p-4">
                <div class="mb-4 flex items-center justify-between">
                  <h3 class="font-medium text-slate-800">Passenger {{ $index + 1 }}</h3>
                  @if (passengers.length > 1) {
                    <button
                      type="button"
                      (click)="removePassenger($index)"
                      class="text-sm text-red-600 hover:text-red-800">
                      Remove
                    </button>
                  }
                </div>

                <div class="grid gap-4 md:grid-cols-2">
                  <!-- Full Name -->
                  <div>
                    <label [for]="'fullName' + $index" class="mb-1 block text-sm font-medium text-slate-700">
                      Full Name <span class="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      [id]="'fullName' + $index"
                      formControlName="fullName"
                      class="block w-full rounded-md border border-slate-200 bg-white px-4 py-2 text-slate-800 shadow-sm outline-none transition hover:border-slate-300 focus:border-indigo-400 focus:ring-1 focus:ring-indigo-300"
                      placeholder="John Doe"
                      [class.border-red-500]="passenger.get('fullName')?.invalid && passenger.get('fullName')?.touched" />
                    @if (passenger.get('fullName')?.invalid && passenger.get('fullName')?.touched) {
                      <p class="mt-1 text-xs text-red-600">Full name is required.</p>
                    }
                  </div>

                  <!-- Gender -->
                  <div>
                    <label [for]="'gender' + $index" class="mb-1 block text-sm font-medium text-slate-700">
                      Gender <span class="text-red-500">*</span>
                    </label>
                    <select
                      [id]="'gender' + $index"
                      formControlName="gender"
                      class="block w-full rounded-md border border-slate-200 bg-white px-4 py-2 text-slate-800 shadow-sm outline-none transition hover:border-slate-300 focus:border-indigo-400 focus:ring-1 focus:ring-indigo-300"
                      [class.border-red-500]="passenger.get('gender')?.invalid && passenger.get('gender')?.touched">
                      <option value="">Select gender</option>
                      <option value="MALE">Male</option>
                      <option value="FEMALE">Female</option>
                      <option value="OTHER">Other</option>
                    </select>
                    @if (passenger.get('gender')?.invalid && passenger.get('gender')?.touched) {
                      <p class="mt-1 text-xs text-red-600">Gender is required.</p>
                    }
                  </div>

                  <!-- Age -->
                  <div>
                    <label [for]="'age' + $index" class="mb-1 block text-sm font-medium text-slate-700">
                      Age <span class="text-red-500">*</span>
                    </label>
                    <input
                      type="number"
                      [id]="'age' + $index"
                      formControlName="age"
                      min="1"
                      max="120"
                      class="block w-full rounded-md border border-slate-200 bg-white px-4 py-2 text-slate-800 shadow-sm outline-none transition hover:border-slate-300 focus:border-indigo-400 focus:ring-1 focus:ring-indigo-300"
                      placeholder="25"
                      [class.border-red-500]="passenger.get('age')?.invalid && passenger.get('age')?.touched" />
                    @if (passenger.get('age')?.invalid && passenger.get('age')?.touched) {
                      <p class="mt-1 text-xs text-red-600">
                        @if (passenger.get('age')?.errors?.['required']) {
                          Age is required.
                        } @else if (passenger.get('age')?.errors?.['min'] || passenger.get('age')?.errors?.['max']) {
                          Age must be between 1 and 120.
                        }
                      </p>
                    }
                  </div>

                  <!-- Seat Number -->
                  <div>
                    <label [for]="'seatNumber' + $index" class="mb-1 block text-sm font-medium text-slate-700">
                      Seat Number <span class="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      [id]="'seatNumber' + $index"
                      formControlName="seatNumber"
                      class="block w-full rounded-md border border-slate-200 bg-white px-4 py-2 text-slate-800 shadow-sm outline-none transition hover:border-slate-300 focus:border-indigo-400 focus:ring-1 focus:ring-indigo-300"
                      placeholder="12A"
                      [class.border-red-500]="passenger.get('seatNumber')?.invalid && passenger.get('seatNumber')?.touched" />
                    @if (passenger.get('seatNumber')?.invalid && passenger.get('seatNumber')?.touched) {
                      <p class="mt-1 text-xs text-red-600">Seat number is required.</p>
                    }
                  </div>

                  <!-- Meal Option -->
                  <div class="md:col-span-2">
                    <label [for]="'mealOption' + $index" class="mb-1 block text-sm font-medium text-slate-700">
                      Meal Option <span class="text-red-500">*</span>
                    </label>
                    <select
                      [id]="'mealOption' + $index"
                      formControlName="mealOption"
                      class="block w-full rounded-md border border-slate-200 bg-white px-4 py-2 text-slate-800 shadow-sm outline-none transition hover:border-slate-300 focus:border-indigo-400 focus:ring-1 focus:ring-indigo-300"
                      [class.border-red-500]="passenger.get('mealOption')?.invalid && passenger.get('mealOption')?.touched">
                      <option value="">Select meal option</option>
                      <option value="VEG">Vegetarian</option>
                      <option value="NON_VEG">Non-Vegetarian</option>
                      <option value="VEGAN">Vegan</option>
                    </select>
                    @if (passenger.get('mealOption')?.invalid && passenger.get('mealOption')?.touched) {
                      <p class="mt-1 text-xs text-red-600">Meal option is required.</p>
                    }
                  </div>
                </div>
              </div>
            }
          </div>
        </div>

        <!-- Submit Button -->
        <div class="flex items-center gap-4">
          <button
            type="submit"
            class="inline-flex items-center rounded-md bg-indigo-600 px-6 py-3 text-sm font-semibold text-white shadow-sm transition hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:bg-indigo-300"
            [disabled]="loading() || bookingForm.invalid">
            @if (loading()) {
              <svg class="mr-2 h-5 w-5 animate-spin text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
              </svg>
            }
            {{ loading() ? 'Processing...' : 'Confirm Booking' }}
          </button>
          <button
            type="button"
            (click)="goBack()"
            class="rounded-md border border-slate-300 bg-white px-6 py-3 text-sm font-semibold text-slate-700 transition hover:bg-slate-50">
            Cancel
          </button>
        </div>
      </form>
    }
  </div>
</div>

